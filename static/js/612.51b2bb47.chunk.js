"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[612],{99462:(e,s,t)=>{t.d(s,{A:()=>F});var a=t(9950),n=t(44268),l=t(45199),i=t(24615),r=t(26120),o=t(82053),c=t(93230),d=t(66699),h=t(36080),u=t(75271),x=t(15231),f=t(4804),m=t(99624),j=t(44137),p=t(19223),g=t(66666),A=t(30656),y=t(44294);var w=t(44414);const v=(0,r.A)((e=>({appBar:{position:"relative"},title:{flex:"0 0 auto"},iconSmall:{fontSize:20}})))((e=>{let{file:s,onMetaDataChange:t}=e;const[n,l]=(0,a.useState)({dwv:(0,y.getDwvVersion)(),react:a.version}),[r,v]=(0,a.useState)({Scroll:{},ZoomAndPan:{},WindowLevel:{},Draw:{options:["Ruler"]}}),[b,S]=(0,a.useState)("Select Tool"),[N,k]=(0,a.useState)(0),[C,D]=(0,a.useState)(!1),[L,I]=(0,a.useState)(null),[H,M]=(0,a.useState)(void 0),[E,F]=(0,a.useState)(!1),R=((0,i.A)(),(e,s)=>{s&&T(s)}),O=e=>{let s;return"Scroll"===e?s=(0,w.jsx)(m.A,{}):"ZoomAndPan"===e?s=(0,w.jsx)(p.A,{}):"WindowLevel"===e?s=(0,w.jsx)(j.A,{}):"Draw"===e&&(s=(0,w.jsx)(g.A,{})),s},z=e=>{if(!L)return!1;let s;return s="Scroll"===e?L.canScroll():"WindowLevel"!==e||L.canWindowLevel(),s},B=Object.keys(r).map((e=>(0,w.jsx)(u.A,{value:e,title:e,disabled:!C||!z(e),onChange:()=>R(),children:O(e)},e))),T=e=>{L&&(S(e),L.setTool(e),"Draw"===e&&P(r.Draw.options[0]))},P=e=>{L&&L.setToolFeatures({shapeName:e})},K=e=>{k(e)},U=e=>{t(e.getMetaData(0)),D(!0)};return(0,a.useEffect)((()=>{const e=((e,s,t,a)=>{y.decoderScripts.jpeg2000="".concat("/DigitalHealthApp","/assets/dwv/decoders/pdfjs/decode-jpeg2000.js"),y.decoderScripts["jpeg-lossless"]="".concat("/DigitalHealthApp","/assets/dwv/decoders/rii-mango/decode-jpegloss.js"),y.decoderScripts["jpeg-baseline"]="".concat("/DigitalHealthApp","/assets/dwv/decoders/pdfjs/decode-jpegbaseline.js"),y.decoderScripts.rle="".concat("/DigitalHealthApp","/assets/dwv/decoders/dwv/decode-rle.js");const n=new y.App;n.init({dataViewConfigs:{"*":[{divId:"layerGroup0"}]},tools:e});let l=null,i=null,r=null,o=null;return n.addEventListener("loadstart",(()=>{l=0,i=0,r=0,o=!0})),n.addEventListener("loadprogress",(e=>{s(e.loaded)})),n.addEventListener("renderend",(()=>{if(o){o=!1;let e="ZoomAndPan";n.canScroll()&&(e="Scroll"),a(e)}})),n.addEventListener("load",(()=>{t(n)})),n.addEventListener("loadend",(()=>{i&&(s(0),alert("Received errors during load. Check log for details.")),r&&(s(0),alert("Load was aborted."))})),n.addEventListener("loaditem",(()=>{++l})),n.addEventListener("loaderror",(e=>{console.error(e.error),++i})),n.addEventListener("loadabort",(()=>{++r})),n.addEventListener("keydown",(e=>{n.defaultOnKeydown(e)})),n})(r,K,U,T);I(e)}),[]),(0,a.useEffect)((()=>{L&&L.loadFiles([s])}),[L]),(0,w.jsxs)("div",{id:"dwv",children:[(0,w.jsx)(d.A,{variant:"determinate",value:N}),L&&(0,w.jsxs)(c.A,{direction:"row",spacing:1,padding:1,justifyContent:"center",children:[(0,w.jsx)(x.A,{size:"small",color:"primary",value:b,exclusive:!0,onChange:R,children:B}),(0,w.jsx)(u.A,{size:"small",value:"reset",title:"Reset",disabled:!C,onChange:()=>{L&&L.resetDisplay()},children:(0,w.jsx)(f.A,{})}),(0,w.jsx)(u.A,{size:"small",value:"toggleOrientation",title:"Toggle Orientation",disabled:!C,onClick:()=>{"undefined"!==typeof H?"axial"===H?M("coronal"):"coronal"===H?M("sagittal"):"sagittal"===H&&M("axial"):M("coronal");const e={"*":[{divId:"layerGroup0",orientation:H}]};L.setDataViewConfigs(e);for(let s=0;s<L.getNumberOfLoadedData();++s)L.render(s)},children:(0,w.jsx)(A.A,{})})]}),(0,w.jsx)("div",{id:"layerGroup0",className:"layerGroup",children:(0,w.jsx)("div",{id:"dropBox"})}),(0,w.jsx)("div",{children:(0,w.jsx)("p",{className:"legend",children:(0,w.jsxs)(o.A,{variant:"caption",children:["Powered by ",(0,w.jsx)(h.A,{href:"https://github.com/ivmartel/dwv",title:"dwv on github",color:"inherit",children:"dwv"})," ",n.dwv," and ",(0,w.jsx)(h.A,{href:"https://github.com/facebook/react",title:"react on github",color:"inherit",children:"React"})," ",n.react]})})})]})}));var b=t(2046),S=t(89931),N=t(2235),k=t(15769),C=t(1320),D=t(34075),L=t(21671),I=t(69780),H=t(9213);class M extends a.Component{constructor(e){super(e),this.onSliderChange=e=>{const s=parseInt(e.target.value,10),t=this.getMetaArray(s);this.setState({instanceNumber:s,displayData:t}),this.filterList(this.state.searchfor,s)},this.onSearch=e=>{var s=e.target.value;this.filterList(s,this.state.instanceNumber)};const s=this.props.data;this.state={fullMetaData:s,searchfor:""};const t=s["00200013"];if("undefined"!==typeof t){let e=t.value;"string"===typeof e&&(e=[e]);const s=e.map(Number);s.sort(((e,s)=>e-s)),this.state.sliderMin=s[0],this.state.sliderMax=s[s.length-1],this.state.instanceNumber=s[0],this.state.instanceNumbers=s}this.state.displayData=this.getMetaArray(this.state.sliderMin),this.filterList=this.filterList.bind(this)}filterList(e,s){var t=e.toLowerCase(),a=this.getMetaArray(s).filter((function(e){for(var s in e)if(e.hasOwnProperty(s)){var a=e[s];if("undefined"!==typeof a&&("string"!==typeof a&&(a=a.toString()),-1!==a.toLowerCase().indexOf(t)))return!0}return!1}));this.setState({searchfor:e,displayData:a})}getMetaArray(e){if("undefined"!==typeof this.state.instanceNumbers&&!this.state.instanceNumbers.includes(e))return console.warn("Invalid instance number: ",e),[];let s;s=this.isDicomMeta(this.state.fullMetaData)?this.getDicomTagReducer(this.state.fullMetaData,e,""):this.getTagReducer(this.state.fullMetaData);return Object.keys(this.state.fullMetaData).reduce(s,[])}isDicomMeta(e){return"undefined"!==typeof e["00020010"]}getTagReducer(e){return function(s,t){return s.push({name:t,value:e[t].value}),s}}getDicomTagReducer(e,s,t){return(a,n)=>{const l=(0,y.getTagFromKey)(n);let i=l.getNameFromDictionary();"undefined"===typeof i&&(i="x"+l.getKey());const r=i,o=e[n];let c=o.value;if("undefined"===typeof c.slice&&"undefined"!==typeof c[s]&&(c=c[s]),"InstanceNumber"===r&&(c=s),"SQ"===o.vr){a.push({name:(t?t+" ":"")+r,value:""});for(let e=0;e<c.length;++e){const n=c[e],l=Object.keys(n).reduce(this.getDicomTagReducer(n,s,t+"["+e+"]"),[]);a=a.concat(l)}}else"O"===o.vr[0]&&c.length>10&&(c=c.slice(0,10).toString()+"... (len:"+c.length+")"),a.push({name:(t?t+" ":"")+r,value:c.toString()});return a}}render(){const{classes:e}=this.props,{displayData:s,searchfor:t,sliderMin:a,sliderMax:n}=this.state;return(0,w.jsxs)("div",{className:e.container,children:[(0,w.jsx)(c.A,{direction:"row",spacing:2,children:(0,w.jsx)(S.A,{id:"search",type:"search",value:t,className:e.searchField,onChange:this.onSearch,margin:"normal",size:"small",InputProps:{startAdornment:(0,w.jsx)(b.A,{position:"start",children:(0,w.jsx)(p.A,{})})}})}),(0,w.jsx)(N.A,{sx:{width:"100%",overflow:"hidden"},children:(0,w.jsx)(C.A,{sx:{maxHeight:700},children:(0,w.jsxs)(k.A,{stickyHeader:!0,className:e.table,children:[(0,w.jsx)(I.A,{children:(0,w.jsxs)(H.A,{children:[(0,w.jsx)(L.A,{children:"Tag"}),(0,w.jsx)(L.A,{children:"Value"})]})}),(0,w.jsx)(D.A,{children:s.map(((e,s)=>(0,w.jsxs)(H.A,{children:[(0,w.jsx)(L.A,{children:e.name}),(0,w.jsx)(L.A,{children:e.value})]},s)))})]})})})]})}}const E=(0,r.A)((e=>({flex:{flex:1},spacer:{flex:"1 1 100%"},searchField:{width:"45%"},slider:{margin:20},container:{padding:10,overflow:"hidden"}})))(M),F=e=>{let{show:s,onHide:t,file:i}=e;const[r,o]=(0,a.useState)("viewer"),[c,d]=(0,a.useState)({});return(0,w.jsx)(n.A,{show:s,fullscreen:!0,onHide:t,children:(0,w.jsxs)(n.A.Body,{children:[(0,w.jsxs)(l.A,{fill:!0,variant:"tabs",defaultActiveKey:"viewer",onSelect:(e,s)=>((e,s)=>{s.preventDefault(),o(e)})(e,s),children:[(0,w.jsx)(l.A.Item,{children:(0,w.jsx)(l.A.Link,{eventKey:"viewer",children:"Image"})}),(0,w.jsx)(l.A.Item,{children:(0,w.jsx)(l.A.Link,{eventKey:"tags",children:"Tags"})})]}),"viewer"===r&&(0,w.jsx)(v,{file:i,onMetaDataChange:e=>{d(e)}}),"tags"===r&&c&&(0,w.jsx)(E,{data:c})]})})}},70612:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Z});var a=t(9950),n=t(28429),l=t(45358),i=t(81605),r=t(97937),o=t(19360),c=t(11534),d=t(18481),h=t(45199),u=t(14798),x=t(29949),f=t(22875),m=t(90917),j=t(82096),p=t(44414);const g=e=>{let{user:s,handleSelect:t}=e;const{logout:l}=(0,d.r)();(0,n.Zp)();return(0,a.useEffect)((()=>{console.log(s)}),[]),(0,p.jsxs)(u.A,{className:"d-flex flex-column col-2 border border-start-0 rounded-end py-2 px-3",children:[(0,p.jsx)(u.A.Brand,{className:"mb-4 mt-3",href:"#",children:"Medical Sharing"}),(0,p.jsxs)(h.A,{variant:"pills",defaultActiveKey:"authorization",className:"d-flex flex-column col-12",onSelect:(e,s)=>((e,s)=>{s.preventDefault(),"logout"===e&&l(),t(e)})(e,s),children:[(0,p.jsx)(h.A.Item,{children:(0,p.jsxs)(h.A.Link,{eventKey:"authorization",children:[(0,p.jsx)(x.jh0,{}),"Authorize People"]})}),(0,p.jsx)(h.A.Item,{children:(0,p.jsxs)(h.A.Link,{eventKey:"my-files",children:[(0,p.jsx)(x.bm4,{}),"Manage Your Files"]})}),(0,p.jsx)(h.A.Item,{children:(0,p.jsxs)(h.A.Link,{eventKey:"authorized-files",children:[(0,p.jsx)(m.D_b,{}),"Shared Files"]})}),(0,p.jsx)(h.A.Item,{children:(0,p.jsxs)(h.A.Link,{eventKey:"notification",children:[(0,p.jsx)(f.hbh,{}),"Notifications"]})}),(0,p.jsx)(h.A.Item,{children:(0,p.jsxs)(h.A.Link,{eventKey:"logout",children:[(0,p.jsx)(j.YZx,{}),"Logout"]})})]})]})};var A=t(44268),y=t(16449);const w=e=>{let{show:s,onHide:t,onConfirm:n}=e;const[l,i]=(0,a.useState)("");(0,a.useEffect)((()=>{i("")}),[s]);return(0,p.jsxs)(A.A,{show:s,onHide:t,centered:!0,children:[(0,p.jsx)(A.A.Header,{closeButton:!0,children:(0,p.jsx)(A.A.Title,{children:"Confirm Password"})}),(0,p.jsx)(A.A.Body,{children:(0,p.jsx)(y.A,{children:(0,p.jsxs)(y.A.Group,{controlId:"password",children:[(0,p.jsx)(y.A.Label,{children:"Password:"}),(0,p.jsx)(y.A.Control,{type:"password",value:l,onChange:e=>i(e.target.value)})]})})}),(0,p.jsxs)(A.A.Footer,{children:[(0,p.jsx)(r.A,{variant:"secondary",onClick:t,children:"Cancel"}),(0,p.jsx)(r.A,{variant:"primary",onClick:()=>{n(l),t()},children:"Confirm"})]})]})},v=e=>{let{show:s,onHide:t,onAddFile:n}=e;const[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{i(null)}),[s]),(0,p.jsxs)(A.A,{show:s,onHide:t,centered:!0,children:[(0,p.jsx)(A.A.Header,{closeButton:!0,children:(0,p.jsx)(A.A.Title,{children:"Add File"})}),(0,p.jsx)(A.A.Body,{children:(0,p.jsxs)(y.A,{children:[(0,p.jsxs)(y.A.Group,{className:"mb-3",children:[(0,p.jsx)(y.A.Label,{children:"Input File"}),(0,p.jsx)(y.A.Control,{type:"file",name:"input-file",id:"input-file",onChange:e=>{return(s=e).preventDefault(),void i(s.target.files);var s}})]}),(0,p.jsx)(y.A.Switch,{label:"Encryption",onChange:e=>c((e=>!e))})]})}),(0,p.jsxs)(A.A.Footer,{children:[(0,p.jsx)(r.A,{variant:"secondary",onClick:t,children:"Cancel"}),(0,p.jsx)(r.A,{variant:"primary",type:"submit",onClick:e=>(e=>{e.preventDefault(),n(l,o)})(e),children:"Add File"})]})]})};t(13898),t(76487),t(92723);var b=t(52465),S=(t(99462),t(8966));const N=e=>{let{show:s,onHide:t,content:n}=e;return(0,a.useEffect)((()=>{n&&console.log(n)}),[s,n]),(0,p.jsxs)(A.A,{show:s,onHide:t,children:[(0,p.jsx)(A.A.Header,{closeButton:!0,children:n&&(0,p.jsx)(A.A.Title,{children:n.admissionContent.messageType})}),(0,p.jsx)(A.A.Body,{children:n&&(0,p.jsx)(S.A,{children:Object.entries(n.admissionContent).map((e=>{let[s,t]=e;return"messageType"!==s&&(0,p.jsxs)(S.A.Item,{eventKey:s,children:[(0,p.jsx)(S.A.Header,{children:s.charAt(0).toUpperCase()+s.slice(1)}),(0,p.jsx)(S.A.Body,{children:"admissionReason"===s?t:t.join(", ")})]},s)}))})})]})};var k=t(75208),C=t(35298),D=t(60123),L=t(66187);C.t1.register(C.PP,C.kc,C.E8,C.Bs,C.FN,C.No,C.hE,C.dN,C.m_,C.s$);const I="rgba(255, 99, 132, 0.2)",H="rgba(75, 192, 192, 0.2)",M="rgba(255, 159, 64, 0.2)",E={"rgba(255, 99, 132, 0.2)":"rgba(255, 99, 132, 1)","rgba(75, 192, 192, 0.2)":"rgba(75, 192, 192, 1)","rgba(255, 159, 64, 0.2)":"rgba(255, 159, 64, 1)"},F=e=>{let{data:s,labels:t}=e;const[n,i]=(0,a.useState)({responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Chart.js Bar Chart"}},scales:{x:{min:0,max:9}}}),[r,o]=(0,a.useState)(0),c=t.length,d=Math.ceil((c-10)/2);return(0,p.jsxs)(l.A,{children:[(0,p.jsx)(L.N1,{options:n,data:{labels:t,datasets:[{fill:!0,data:s,borderColor:"rgb(53, 162, 235)",backgroundColor:"rgba(53, 162, 235, 0.5)"}]}}),(0,p.jsx)(l.A,{children:(0,p.jsx)(D.Ay,{value:r,onChange:(e,s)=>{const t=JSON.parse(JSON.stringify(n));let a=n.scales.x.min,l=n.scales.x.max;if(r!==s)if(c-a>=10){let e=2*s;t.scales.x.min=e,t.scales.x.max=e+9,i(t),o(s)}else if(l===c){console.log(l,c);let e=2*s;t.scales.x.min=e,t.scales.x.max=e+9,i(t),o(s)}},step:1,min:0,max:d})})]})},R=e=>{let{data:s}=e;const[t,n]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const e=s.filter((e=>e.value<90)).length,t=s.filter((e=>e.value>100)).length,a=s.length-e-t,l=(Math.ceil(e/s.length*100),Math.ceil(t/s.length*100),Math.ceil(a/s.length*100),[M,I,H]),i=l.map((e=>E[e])),r={labels:["Low Days < 90","High Days > 100","Normal"],datasets:[{label:"# of Votes",data:[e,t,a],backgroundColor:l,borderColor:i,borderWidth:1}]};console.log(a,e,t),n(r)}),[]),t&&(0,p.jsx)(l.A,{className:"d-flex justify-content-center",children:(0,p.jsx)(L.nu,{data:t})})},O=e=>{let{data:s,labels:t}=e;const[n,i]=(0,a.useState)({responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Chart.js Bar Chart"}},scales:{x:{min:0,max:9}}}),[r,o]=(0,a.useState)(0),[c,d]=(0,a.useState)([]),[h,u]=(0,a.useState)([]),x=t.length,f=Math.ceil((x-10)/2);return(0,a.useEffect)((()=>{const e=s.map((e=>e<60?M:e>100?I:H)),t=e.map((e=>E[e]));d(e),u(t)}),[]),c&&h&&(0,p.jsxs)(l.A,{children:[(0,p.jsx)(L.yP,{options:n,data:{labels:t,datasets:[{label:"Beat Per Minute",data:s,backgroundColor:c,borderColor:h,borderWidth:1}]},onClick:()=>{}}),(0,p.jsx)(l.A,{children:(0,p.jsx)(D.Ay,{value:r,onChange:(e,s)=>{const t=JSON.parse(JSON.stringify(n));let a=n.scales.x.min,l=n.scales.x.max;if(r!==s)if(console.log(s,a,l,x),x-a>=10){let e=2*s;t.scales.x.min=e,t.scales.x.max=e+9,i(t),o(s)}else if(l===x){console.log(l,x);let e=2*s;t.scales.x.min=e,t.scales.x.max=e+9,i(t),o(s)}},step:1,min:0,max:f})})]})};function z(e){let{show:s,onHide:t,content:n}=e;const[i,r]=(0,a.useState)([]),[o,c]=(0,a.useState)(null),[d,h]=(0,a.useState)(null),[u,x]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const e=n.map((e=>e.DateTime)),s=n.map((e=>e.HeartRate)),t=n.map((e=>e.BloodPressure)),a=n.map((e=>e.OxygenLevel));r(e),x(a),h(t),c(s)}),[]),(0,p.jsxs)(A.A,{fullscreen:!0,show:s,onHide:t,children:[(0,p.jsx)(A.A.Header,{closeButton:!0}),(0,p.jsx)(A.A.Body,{children:(0,p.jsxs)(l.A,{fluid:!0,className:"d-flex flex-column overflow",children:[o&&(0,p.jsx)(O,{data:o,labels:i}),u&&(0,p.jsx)(R,{data:u}),d&&(0,p.jsx)(F,{data:d,labels:i})]})})]})}var B=t(79652),T=t(42935);t(33832),t(34691);const P=e=>{let{fileList:s,owner:t,accessor:o}=e;const[c,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)(null),[x,f]=(0,a.useState)(),[m,g]=(0,a.useState)(null),A=(0,n.Zp)(),y={Download:{method:async(e,s)=>{const{blob:a,fileName:n}=await(0,b.BF)(s.fileHash,t.key,o.key),l=URL.createObjectURL(a);window.open(l),URL.revokeObjectURL(l)},icon:(0,p.jsx)(j.qqM,{className:"icon theme"})},Open:{method:async(e,s)=>{e.preventDefault();try{if("dcm"===s.fileExtension){const e="/DigitalHealthApp/dicom/?fileHash=".concat(s.fileHash,"&owner=").concat(t.key,"&accessor=").concat(o.key);return void A(e)}if("hl7"===s.fileExtension){const e=await(0,b.GD)(s.fileHash,t.key,o.key);u(e),d(!0)}else if("json"===s.fileExtension){const{blob:e,fileName:a}=await(0,b.BF)(s.fileHash,t.key,o.key),n=new FileReader;n.onload=function(){g(JSON.parse(this.result))},n.readAsText(e),f(!0)}else{const{blob:e,fileName:a}=await(0,b.BF)(s.fileHash,t.key,o.key),n=URL.createObjectURL(e);window.open(n),URL.revokeObjectURL(n)}}catch(a){console.error(a)}},icon:(0,p.jsx)(j.W8l,{className:"icon theme"})},Remove:{method:async(e,s)=>{const t=await(0,b.Ww)(s.fileId);console.log(t)},icon:(0,p.jsx)(T.Yzb,{className:"icon theme"})}};return(0,a.useEffect)((()=>{}),[s]),(0,p.jsxs)(l.A,{style:{height:"85%"},children:[(0,p.jsxs)(l.A,{fluid:!0,className:"d-flex flex-row mb-2",children:[(0,p.jsx)(l.A,{className:"col-3",children:"Date Added"}),(0,p.jsx)(l.A,{className:"col-5",children:"File Name"}),(0,p.jsx)(l.A,{className:"col-1",children:"File Mode"}),(0,p.jsx)(l.A,{className:"d-flex col-3 justify-content-center",children:"Actions"})]}),s&&(0,p.jsx)(i.A,{children:s.map(((e,s)=>{const a=new Date(e.addedDate);return(0,p.jsxs)(i.A.Item,{className:"d-flex mb-3 justify-content-around shadow rounded",children:[(0,p.jsx)(l.A,{className:"align-items-center col-3",children:"".concat(a.toLocaleDateString()," ").concat(a.toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}))}),(0,p.jsx)(l.A,{className:"col-5",style:{maxWidth:"50%"},children:e.fileName+"."+e.fileExtension}),(0,p.jsx)(l.A,{className:"col-1",children:e.fileMode}),(0,p.jsx)(l.A,{className:"d-flex flex-row col-3 justify-content-around align-items-center",children:e.fileActions.map((s=>{if("Remove"===s.name&&t.userId!==o.userId)return;const a=y[s.name];return a?(0,p.jsx)(k.A,{className:"action-icon",sx:{bgcolor:"transparent"},children:(0,p.jsx)(r.A,{style:{backgroundColor:"transparent",width:"auto",boxShadow:"none",justifyContent:"center",alignItems:"center"},className:" col-3 rounded-circle",onClick:s=>a.method(s,e),children:a.icon})},s.id):void 0}))})]},s)}))}),(0,p.jsx)(N,{show:c,onHide:()=>{d(!1)},content:h}),m&&(0,p.jsx)(z,{show:x,onHide:()=>{f(!1)},content:m})]})},K=e=>{let{owner:s,accessor:t}=e;const[n,l]=(0,a.useState)(!1);return(0,p.jsxs)(a.Fragment,{children:[(0,p.jsxs)(r.A,{onClick:e=>(e=>{e.preventDefault(),l(!0)})(e),children:[(0,p.jsx)(B.LzS,{}),"Add File"]}),(0,p.jsx)(v,{show:n,onHide:()=>{l(!1)},onAddFile:async(e,a)=>{if(s&&e&&a){const a=new FormData;for(let s=0;s<e.length;s++)a.append("files",e[s]);a.append("owner",JSON.stringify(s)),a.append("accessor",JSON.stringify(t)),(0,b.R3)(a)}}})]})},U=e=>{let{ipfs:s,owner:t}=e;const[n,i]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{const e=await(0,b.XU)(t.userId);i(e),console.log(e)})()}),[]),(0,p.jsxs)(l.A,{fluid:!0,className:"pt-5",style:{height:"100%"},children:[(0,p.jsx)(l.A,{fluid:!0,className:"d-flex flex-column mb-3",style:{height:"80%",overflowY:"scroll"},children:n.length>0?(0,p.jsx)(P,{fileList:n,ipfs:s,owner:t,accessor:t}):(0,p.jsx)(o.A,{variant:"light",children:"You have not been authorized for any file "})}),(0,p.jsx)(l.A,{fluid:!0,className:"d-flex justify-content-end mb-3",children:(0,p.jsx)(K,{ipfs:s,owner:t,accessor:t})})]})},W=e=>{let{accessor:s}=e;const[t,n]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{const e=await(0,b.fu)(s.userId);console.log(e),n(e)})()}),[]),(0,p.jsx)(l.A,{className:"mb-3 pt-4",style:{height:"100%",maxHeight:"100%",overflowY:"scroll"},children:t.length>0?(0,p.jsxs)(a.Fragment,{children:[(0,p.jsx)(y.A.Label,{style:{height:"50px",fontWeight:"500",fontSize:"18px"},children:"Authorized File List"}),(0,p.jsx)(S.A,{children:t.map(((e,t)=>(0,p.jsx)(l.A,{style:{height:"200px"},children:(0,p.jsxs)(S.A.Item,{eventKey:t,children:[(0,p.jsxs)(S.A.Header,{className:"d-flex ",children:[(0,p.jsx)(l.A,{className:"d-flex col",children:e.userName}),(0,p.jsx)(l.A,{className:"d-flex col-10 justify-content-end",children:(0,p.jsx)(K,{owner:{userId:e.ownerId,key:e.key},accessor:s})})]}),(0,p.jsx)(S.A.Body,{children:(0,p.jsx)(P,{fileList:e.informationList,owner:{userId:e.ownerId,key:e.key},accessor:s})})]},t)})))})]}):(0,p.jsx)(o.A,{variant:"light",children:"You have not been authorized for any file"})})};var Y=t(67532),G=t(1322);function V(){const[e,s]=(0,a.useState)(null),[t,n]=(0,a.useState)(null),{user:i}=(0,d.r)(),r={Upload:"uploaded a file",Open:"opened a file",Remove:"removed a file"};return(0,a.useEffect)((()=>{(async()=>{const e=(await(0,b.Tr)(i.userId)).map((e=>({id:e.id,name:e.accessorName,fileName:"".concat(e.fileName,".").concat(e.fileExtension),imageUri:"https://images.unsplash.com/photo-1707655096648-1655344fc4d5?q=80&w=987&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",message:r[e.actionName],isRead:e.isRead,createdDate:e.createdDate}))),t=e.filter((e=>!e.isRead)).length;s(e),n(t)})()}),[]),e&&(0,p.jsxs)(l.A,{fluid:!0,style:{padding:0,height:"100%",margin:0},children:[(0,p.jsx)(l.A,{fluid:!0,className:"theme",style:{height:"50px",fontWeight:"500",fontSize:"25px"},children:"Notification (".concat(t,")")}),(0,p.jsx)(l.A,{fluid:!0,className:"d-flex flex-row justify-content-end my-3",children:(0,p.jsxs)(l.A,{className:"d-flex align-self-end shadow px-2 justify-content-between align-items-center rounded-4 ",style:{width:"30%",height:"40px"},children:[(new Date).toLocaleDateString(),(0,p.jsx)(f.LyP,{})]})}),(0,p.jsx)(l.A,{fluid:!0,className:"theme",style:{height:"50px",fontWeight:"500",fontSize:"18px"},children:"Today"}),(0,p.jsx)(l.A,{fluid:!0,style:{maxHeight:"500px",overflowY:"scroll"},children:e.map(((e,s)=>((e,s)=>(0,p.jsxs)(l.A,{fluid:!0,className:"d-flex shadow flex-row py-5 mb-3 align-items-center rounded",style:{height:"50px"},children:[(0,p.jsx)("div",{className:"mx-3 rounded-circle",style:{backgroundColor:e.isRead?"white":"orange",width:"14px",height:"11px"}}),(0,p.jsx)(k.A,{className:"shadow m-3",alt:"Travis Howard",src:e.imageUri}),(0,p.jsxs)("p",{className:"message mb-0 ms-3",children:[(0,p.jsxs)("span",{className:"span-message",children:[e.name," "]})," "," ".concat(e.message," ")," ",(0,p.jsxs)("span",{className:"span-message",children:[e.fileName," "]})]}),(0,p.jsxs)("p",{className:"message-time mb-0",children:["  ",new Date(e.createdDate).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})]})]},s))(e,s)))}),(0,p.jsx)(l.A,{})]})}const J=e=>{let{authorizationList:s,handleOpenModal:t}=e;return(0,p.jsx)(l.A,{className:"mb-3 mt-3",style:{height:"100%",maxHeight:"100%",overflowY:"scroll"},children:(0,p.jsx)(i.A,{children:s.map((e=>(0,p.jsxs)(i.A.Item,{className:"d-flex justify-content-between text mb-3 shadow rounded",children:[e.name,(0,p.jsx)(r.A,{onClick:s=>t({event:s,accessor:e}),children:"Revoke"})]},e.accessorId)))})})},Z=()=>{const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)("authorization"),{authed:h,user:u}=(0,d.r)(),[x,f]=(0,a.useState)(!1),[m,j]=(0,a.useState)(),[A,y]=(0,a.useState)(null),[v,S]=(0,a.useState)([]),[N,k]=(0,a.useState)([]),{data:C,isPending:D,writeContractAsync:L}=(0,G.x)(),I=(0,n.Zp)(),H=async e=>{let{confirmedPassword:t}=e;if(console.log(A),null==u.userId)return;const a=(0,Y.ye)({accessor:A.accessorKey,password:t,owner:u.key});try{await L(a),await(0,b.Ve)({ownerId:u.key,accessorId:A.accessorKey})}catch(n){console.log(n)}s((e=>e.filter((e=>e.accessorId!==A.accessorId)))),y(null)},M=e=>{let{event:s,accessor:t}=e;s.preventDefault(),y(t),f(!0)};return(0,a.useEffect)((()=>{h||I("/DigitalHealthApp/login"),u.userId&&((async()=>{try{const e=await(0,b.sr)({userId:u.userId});s(e)}catch(e){console.log("Cannot get authorization list"+e)}})(),(async()=>{try{const e=await(0,b.aU)(),s=e.filter((e=>e.userId!==u.userId)).map((e=>({value:e.userId,label:e.name})));S(e),k(s)}catch(e){console.log("Fail to set user list"+e)}})())}),[]),(0,a.useEffect)((()=>{}),[e]),(0,p.jsxs)(l.A,{fluid:!0,className:"custom-container d-flex flex-row mx-0",children:[(0,p.jsx)(g,{user:u,handleSelect:e=>{i(e)}}),(0,p.jsxs)(l.A,{fluid:!0,className:"d-flex flex-column mb-3 ms-5",style:{height:"100%"},children:["authorization"===t&&N&&(0,p.jsxs)(l.A,{className:"mb-3 pt-4",style:{height:"80%"},children:[(0,p.jsx)(c.Ay,{options:N,placeholder:"Select user",value:m,onChange:function(e){j(e)},isSearchable:!0,styles:{control:(e,s)=>({...e,backgroundColor:"white",borderColor:"#070f25",marginBottom:"0.3em",paddingBottom:"0.5rem",paddingTop:"0.5rem"}),option:(e,s)=>{let{data:t,isDisabled:a,isFocused:n,isSelected:l}=s;return{...e,color:"#000",backgroundColor:n?"#d1d2d7":"white"}}}}),(0,p.jsx)(a.Fragment,{children:(0,p.jsx)(r.A,{style:{width:"100%"},variant:"primary",type:"submit",onClick:e=>M({event:e}),children:"Authorize"})}),e.length>0?(0,p.jsx)(J,{authorizationList:e,handleRevoke:H,handleOpenModal:M}):(0,p.jsx)(l.A,{fluid:!0,className:"mt-3",children:(0,p.jsx)(o.A,{variant:"light",children:"You have not authorized anyone"})})]}),"my-files"===t&&(0,p.jsx)(U,{owner:{userId:u.userId,key:u.key}}),"authorized-files"===t&&(0,p.jsx)(W,{accessor:{userId:u.userId,key:u.key}}),"notification"===t&&(0,p.jsx)(V,{})]}),(0,p.jsx)(w,{show:x,onHide:()=>{f(!1)},onConfirm:t=>{A?H({confirmedPassword:t}):(async t=>{let{confirmedPassword:a}=t;const n=v.find((e=>e.userId===m.value));if(null==u.userId||null===n)return;if(n.key==u.key)return;const l=(0,Y.bk)({accessor:n.key,password:a,owner:u.key});try{await L(l),await(0,b.VM)({ownerId:u.key,accessorId:n.key})}catch(i){console.log(i)}s([...e,{accessorId:n.userId,accessorKey:n.key,name:n.name,isAuthorized:!0}])})({confirmedPassword:t})}})]})}}}]);