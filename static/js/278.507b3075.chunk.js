"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[278],{99462:(e,t,a)=>{a.d(t,{A:()=>E});var s=a(9950),i=a(44268),n=a(45199),r=a(24615),o=a(26120),l=a(82053),d=a(93230),c=a(66699),u=a(36080),h=a(75271),p=a(15231),g=a(4804),f=a(99624),x=a(44137),m=a(19223),v=a(66666),A=a(30656),j=a(44294);var w=a(44414);const b=(0,o.A)((e=>({appBar:{position:"relative"},title:{flex:"0 0 auto"},iconSmall:{fontSize:20}})))((e=>{let{file:t,onMetaDataChange:a}=e;const[i,n]=(0,s.useState)({dwv:(0,j.getDwvVersion)(),react:s.version}),[o,b]=(0,s.useState)({Scroll:{},ZoomAndPan:{},WindowLevel:{},Draw:{options:["Ruler"]}}),[y,S]=(0,s.useState)("Select Tool"),[D,L]=(0,s.useState)(0),[k,M]=(0,s.useState)(!1),[C,N]=(0,s.useState)(null),[W,R]=(0,s.useState)(void 0),[T,E]=(0,s.useState)(!1),G=((0,r.A)(),(e,t)=>{t&&F(t)}),O=e=>{let t;return"Scroll"===e?t=(0,w.jsx)(f.A,{}):"ZoomAndPan"===e?t=(0,w.jsx)(m.A,{}):"WindowLevel"===e?t=(0,w.jsx)(x.A,{}):"Draw"===e&&(t=(0,w.jsx)(v.A,{})),t},H=e=>{if(!C)return!1;let t;return t="Scroll"===e?C.canScroll():"WindowLevel"!==e||C.canWindowLevel(),t},I=Object.keys(o).map((e=>(0,w.jsx)(h.A,{value:e,title:e,disabled:!k||!H(e),onChange:()=>G(),children:O(e)},e))),F=e=>{C&&(S(e),C.setTool(e),"Draw"===e&&P(o.Draw.options[0]))},P=e=>{C&&C.setToolFeatures({shapeName:e})},z=e=>{L(e)},K=e=>{a(e.getMetaData(0)),M(!0)};return(0,s.useEffect)((()=>{const e=((e,t,a,s)=>{j.decoderScripts.jpeg2000="".concat("/DigitalHealthApp","/assets/dwv/decoders/pdfjs/decode-jpeg2000.js"),j.decoderScripts["jpeg-lossless"]="".concat("/DigitalHealthApp","/assets/dwv/decoders/rii-mango/decode-jpegloss.js"),j.decoderScripts["jpeg-baseline"]="".concat("/DigitalHealthApp","/assets/dwv/decoders/pdfjs/decode-jpegbaseline.js"),j.decoderScripts.rle="".concat("/DigitalHealthApp","/assets/dwv/decoders/dwv/decode-rle.js");const i=new j.App;i.init({dataViewConfigs:{"*":[{divId:"layerGroup0"}]},tools:e});let n=null,r=null,o=null,l=null;return i.addEventListener("loadstart",(()=>{n=0,r=0,o=0,l=!0})),i.addEventListener("loadprogress",(e=>{t(e.loaded)})),i.addEventListener("renderend",(()=>{if(l){l=!1;let e="ZoomAndPan";i.canScroll()&&(e="Scroll"),s(e)}})),i.addEventListener("load",(()=>{a(i)})),i.addEventListener("loadend",(()=>{r&&(t(0),alert("Received errors during load. Check log for details.")),o&&(t(0),alert("Load was aborted."))})),i.addEventListener("loaditem",(()=>{++n})),i.addEventListener("loaderror",(e=>{console.error(e.error),++r})),i.addEventListener("loadabort",(()=>{++o})),i.addEventListener("keydown",(e=>{i.defaultOnKeydown(e)})),i})(o,z,K,F);N(e)}),[]),(0,s.useEffect)((()=>{C&&C.loadFiles([t])}),[C]),(0,w.jsxs)("div",{id:"dwv",children:[(0,w.jsx)(c.A,{variant:"determinate",value:D}),C&&(0,w.jsxs)(d.A,{direction:"row",spacing:1,padding:1,justifyContent:"center",children:[(0,w.jsx)(p.A,{size:"small",color:"primary",value:y,exclusive:!0,onChange:G,children:I}),(0,w.jsx)(h.A,{size:"small",value:"reset",title:"Reset",disabled:!k,onChange:()=>{C&&C.resetDisplay()},children:(0,w.jsx)(g.A,{})}),(0,w.jsx)(h.A,{size:"small",value:"toggleOrientation",title:"Toggle Orientation",disabled:!k,onClick:()=>{"undefined"!==typeof W?"axial"===W?R("coronal"):"coronal"===W?R("sagittal"):"sagittal"===W&&R("axial"):R("coronal");const e={"*":[{divId:"layerGroup0",orientation:W}]};C.setDataViewConfigs(e);for(let t=0;t<C.getNumberOfLoadedData();++t)C.render(t)},children:(0,w.jsx)(A.A,{})})]}),(0,w.jsx)("div",{id:"layerGroup0",className:"layerGroup",children:(0,w.jsx)("div",{id:"dropBox"})}),(0,w.jsx)("div",{children:(0,w.jsx)("p",{className:"legend",children:(0,w.jsxs)(l.A,{variant:"caption",children:["Powered by ",(0,w.jsx)(u.A,{href:"https://github.com/ivmartel/dwv",title:"dwv on github",color:"inherit",children:"dwv"})," ",i.dwv," and ",(0,w.jsx)(u.A,{href:"https://github.com/facebook/react",title:"react on github",color:"inherit",children:"React"})," ",i.react]})})})]})}));var y=a(2046),S=a(89931),D=a(2235),L=a(15769),k=a(1320),M=a(34075),C=a(21671),N=a(69780),W=a(9213);class R extends s.Component{constructor(e){super(e),this.onSliderChange=e=>{const t=parseInt(e.target.value,10),a=this.getMetaArray(t);this.setState({instanceNumber:t,displayData:a}),this.filterList(this.state.searchfor,t)},this.onSearch=e=>{var t=e.target.value;this.filterList(t,this.state.instanceNumber)};const t=this.props.data;this.state={fullMetaData:t,searchfor:""};const a=t["00200013"];if("undefined"!==typeof a){let e=a.value;"string"===typeof e&&(e=[e]);const t=e.map(Number);t.sort(((e,t)=>e-t)),this.state.sliderMin=t[0],this.state.sliderMax=t[t.length-1],this.state.instanceNumber=t[0],this.state.instanceNumbers=t}this.state.displayData=this.getMetaArray(this.state.sliderMin),this.filterList=this.filterList.bind(this)}filterList(e,t){var a=e.toLowerCase(),s=this.getMetaArray(t).filter((function(e){for(var t in e)if(e.hasOwnProperty(t)){var s=e[t];if("undefined"!==typeof s&&("string"!==typeof s&&(s=s.toString()),-1!==s.toLowerCase().indexOf(a)))return!0}return!1}));this.setState({searchfor:e,displayData:s})}getMetaArray(e){if("undefined"!==typeof this.state.instanceNumbers&&!this.state.instanceNumbers.includes(e))return console.warn("Invalid instance number: ",e),[];let t;t=this.isDicomMeta(this.state.fullMetaData)?this.getDicomTagReducer(this.state.fullMetaData,e,""):this.getTagReducer(this.state.fullMetaData);return Object.keys(this.state.fullMetaData).reduce(t,[])}isDicomMeta(e){return"undefined"!==typeof e["00020010"]}getTagReducer(e){return function(t,a){return t.push({name:a,value:e[a].value}),t}}getDicomTagReducer(e,t,a){return(s,i)=>{const n=(0,j.getTagFromKey)(i);let r=n.getNameFromDictionary();"undefined"===typeof r&&(r="x"+n.getKey());const o=r,l=e[i];let d=l.value;if("undefined"===typeof d.slice&&"undefined"!==typeof d[t]&&(d=d[t]),"InstanceNumber"===o&&(d=t),"SQ"===l.vr){s.push({name:(a?a+" ":"")+o,value:""});for(let e=0;e<d.length;++e){const i=d[e],n=Object.keys(i).reduce(this.getDicomTagReducer(i,t,a+"["+e+"]"),[]);s=s.concat(n)}}else"O"===l.vr[0]&&d.length>10&&(d=d.slice(0,10).toString()+"... (len:"+d.length+")"),s.push({name:(a?a+" ":"")+o,value:d.toString()});return s}}render(){const{classes:e}=this.props,{displayData:t,searchfor:a,sliderMin:s,sliderMax:i}=this.state;return(0,w.jsxs)("div",{className:e.container,children:[(0,w.jsx)(d.A,{direction:"row",spacing:2,children:(0,w.jsx)(S.A,{id:"search",type:"search",value:a,className:e.searchField,onChange:this.onSearch,margin:"normal",size:"small",InputProps:{startAdornment:(0,w.jsx)(y.A,{position:"start",children:(0,w.jsx)(m.A,{})})}})}),(0,w.jsx)(D.A,{sx:{width:"100%",overflow:"hidden"},children:(0,w.jsx)(k.A,{sx:{maxHeight:700},children:(0,w.jsxs)(L.A,{stickyHeader:!0,className:e.table,children:[(0,w.jsx)(N.A,{children:(0,w.jsxs)(W.A,{children:[(0,w.jsx)(C.A,{children:"Tag"}),(0,w.jsx)(C.A,{children:"Value"})]})}),(0,w.jsx)(M.A,{children:t.map(((e,t)=>(0,w.jsxs)(W.A,{children:[(0,w.jsx)(C.A,{children:e.name}),(0,w.jsx)(C.A,{children:e.value})]},t)))})]})})})]})}}const T=(0,o.A)((e=>({flex:{flex:1},spacer:{flex:"1 1 100%"},searchField:{width:"45%"},slider:{margin:20},container:{padding:10,overflow:"hidden"}})))(R),E=e=>{let{show:t,onHide:a,file:r}=e;const[o,l]=(0,s.useState)("viewer"),[d,c]=(0,s.useState)({});return(0,w.jsx)(i.A,{show:t,fullscreen:!0,onHide:a,children:(0,w.jsxs)(i.A.Body,{children:[(0,w.jsxs)(n.A,{fill:!0,variant:"tabs",defaultActiveKey:"viewer",onSelect:(e,t)=>((e,t)=>{t.preventDefault(),l(e)})(e,t),children:[(0,w.jsx)(n.A.Item,{children:(0,w.jsx)(n.A.Link,{eventKey:"viewer",children:"Image"})}),(0,w.jsx)(n.A.Item,{children:(0,w.jsx)(n.A.Link,{eventKey:"tags",children:"Tags"})})]}),"viewer"===o&&(0,w.jsx)(b,{file:r,onMetaDataChange:e=>{c(e)}}),"tags"===o&&d&&(0,w.jsx)(T,{data:d})]})})}},44278:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var s=a(98587),i=a(58168),n=a(9950),r=a(72004),o=a(68483),l=a(74061),d=a(43081),c=a(22880),u=a(70146),h=a(12860),p=a(44414);const g=["className","component","disableGutters","fixed","maxWidth","classes"],f=(0,h.A)(),x=(0,u.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,t["maxWidth".concat((0,d.A)(String(a.maxWidth)))],a.fixed&&t.fixed,a.disableGutters&&t.disableGutters]}}),m=e=>(0,c.A)({props:e,name:"MuiContainer",defaultTheme:f});const v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=x,useThemeProps:a=m,componentName:c="MuiContainer"}=e,u=t((e=>{let{theme:t,ownerState:a}=e;return(0,i.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!a.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})}),(e=>{let{theme:t,ownerState:a}=e;return a.fixed&&Object.keys(t.breakpoints.values).reduce(((e,a)=>{const s=a,i=t.breakpoints.values[s];return 0!==i&&(e[t.breakpoints.up(s)]={maxWidth:"".concat(i).concat(t.breakpoints.unit)}),e}),{})}),(e=>{let{theme:t,ownerState:a}=e;return(0,i.A)({},"xs"===a.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},a.maxWidth&&"xs"!==a.maxWidth&&{[t.breakpoints.up(a.maxWidth)]:{maxWidth:"".concat(t.breakpoints.values[a.maxWidth]).concat(t.breakpoints.unit)}})})),h=n.forwardRef((function(e,t){const n=a(e),{className:h,component:f="div",disableGutters:x=!1,fixed:m=!1,maxWidth:v="lg"}=n,A=(0,s.A)(n,g),j=(0,i.A)({},n,{component:f,disableGutters:x,fixed:m,maxWidth:v}),w=((e,t)=>{const{classes:a,fixed:s,disableGutters:i,maxWidth:n}=e,r={root:["root",n&&"maxWidth".concat((0,d.A)(String(n))),s&&"fixed",i&&"disableGutters"]};return(0,l.A)(r,(e=>(0,o.Ay)(t,e)),a)})(j,c);return(0,p.jsx)(u,(0,i.A)({as:f,ownerState:j,className:(0,r.A)(w.root,h),ref:t},A))}));return h}(),A=v;var j=a(99462),w=a(52465);const b=()=>{const[e,t]=(0,n.useState)(!1),[a,s]=(0,n.useState)(null),i=new URLSearchParams(document.location.search);return(0,n.useEffect)((()=>{(async()=>{const e=i.get("fileHash"),t=i.get("owner"),a=i.get("accessor");try{const{blob:i,fileName:n}=await(0,w.BF)(e,t,a);console.log(i.type);const r=new File([i],n,{type:i.type});s(r)}catch(n){alert(n)}})(),t(!0)}),[]),a?(0,p.jsx)(j.A,{show:e,onHide:()=>{t(!1)},file:a}):(0,p.jsx)(A,{children:"Loading ..."})}}}]);